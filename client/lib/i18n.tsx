import { createContext, useContext, useMemo, useState } from "react";

type Lang = "en" | "hi" | "mr";

type Dict = Record<string, string>;

const dictionaries: Record<Lang, Dict> = {
  en: {
    app_title: "Soil pH Tracker & Fertilizer Advisor",
    app_sub: "Record soil pH by field, visualize trends, export weekly or monthly Excel reports, and get guidance on fertilizer and amendments.",
    add_reading: "Add a Reading",
    date: "Date",
    location: "Location / Plot",
    ph: "pH",
    n: "Nitrogen (N, ppm)",
    k: "Potassium (K, ppm)",
    moisture: "Moisture (%)",
    hydrogen: "Hydrogen (H)",
    crop_type: "Crop Type",
    soil_color: "Soil Color",
    seed_type: "Seed Type",
    fertilizer: "Fertilizer Used",
    pesticide: "Pesticide Used",
    notes_opt: "Notes (optional)",
    add: "Add Reading",
    export_reports: "Export Reports",
    export_weekly: "Export Weekly XLSX",
    export_monthly: "Export Monthly XLSX",
    chart: "Chart",
    ideal_band: "Shaded band indicates typical ideal range (6.0–7.5).",
    google_info: "Google information",
    google_info_sub: "Open a relevant Google search to learn best practices and local guidance.",
    open_google: "Open Google",
    ph_testing_tips: "pH Testing tips",
    fert_vs_ph: "Fertilizer vs pH",
    readings: "Readings",
    filter_manage: "Filter and manage your measurements.",
    all_locations: "All locations",
    search: "Search…",
    th_date: "Date",
    th_location: "Location",
    th_ph: "pH",
    th_moisture: "Moisture",
    th_n: "N",
    th_k: "K",
    th_crop: "Crop",
    th_notes: "Notes",
    th_actions: "Actions",
    empty_table: "No readings yet. Add your first measurement above.",
  },
  hi: {
    app_title: "मिट्टी pH ट्रैकर और उर्वरक सलाह",
    app_sub: "खेतवार pH दर्ज करें, रुझान देखें, साप्ताहिक/मासिक रिपोर्ट एक्सेल में निर्यात करें, और उर्वरक सलाह प्राप्त करें।",
    add_reading: "एंट्री जोड़ें",
    date: "तिथि",
    location: "स्थान/प्लॉट",
    ph: "pH",
    n: "नाइट्रोजन (N, ppm)",
    k: "पोटेशियम (K, ppm)",
    moisture: "नमी (%)",
    hydrogen: "हाइड्रोजन (H)",
    crop_type: "फसल प्रकार",
    soil_color: "मिट्टी का रंग",
    seed_type: "बीज प्रकार",
    fertilizer: "उर्वरक",
    pesticide: "कीटनाशक",
    notes_opt: "टिप्पणियाँ (वैकल्पिक)",
    add: "जोड़ें",
    export_reports: "रिपोर्ट निर्यात करें",
    export_weekly: "साप्ताहिक XLSX",
    export_monthly: "मासिक XLSX",
    chart: "चार्ट",
    ideal_band: "छाया वाला भाग आदर्श सीमा (6.0–7.5) दिखाता है।",
    google_info: "गूगल जानकारी",
    google_info_sub: "स्थानीय मार्गदर्शन और सर्वोत्तम प्रथाएँ",
    open_google: "Google खोलें",
    ph_testing_tips: "pH टेस्टिंग टिप्स",
    fert_vs_ph: "उर्वरक बनाम pH",
    readings: "रीडिंग्स",
    filter_manage: "अपनी माप को फ़िल्टर और प्रबंधित करें।",
    all_locations: "सभी स्थान",
    search: "खोज…",
    th_date: "तिथि",
    th_location: "स्थान",
    th_ph: "pH",
    th_moisture: "नमी",
    th_n: "N",
    th_k: "K",
    th_crop: "फसल",
    th_notes: "टिप्पणियाँ",
    th_actions: "क्रियाएँ",
    empty_table: "अभी कोई रीडिंग नहीं। ऊपर पहली माप जोड़ें।",
  },
  mr: {
    app_title: "माती pH ट्रॅकर आणि खत सल्ला",
    app_sub: "शेतानुसार pH नोंदवा, ट्रेंड पहा, साप्ताहिक/मासिक अहवाल एक्सेलमध्ये निर्यात करा आणि सल्ला मिळवा.",
    add_reading: "नोंद जोडा",
    date: "तारीख",
    location: "स्थान/प्लॉट",
    ph: "pH",
    n: "नायट्रोजन (N, ppm)",
    k: "पोटॅशियम (K, ppm)",
    moisture: "आर्द्रता (%)",
    hydrogen: "हायड्रोजन (H)",
    crop_type: "पिक प्रकार",
    soil_color: "मातीचा रंग",
    seed_type: "बियाण्याचा प्रकार",
    fertilizer: "खत",
    pesticide: "कीटकनाशक",
    notes_opt: "नोट्स (पर्यायी)",
    add: "जोडा",
    export_reports: "अहवाल निर्यात",
    export_weekly: "साप्ताहिक XLSX",
    export_monthly: "मासिक XLSX",
    chart: "चार्ट",
    ideal_band: "छायांकित पट्टा आदर्श श्रेणी (6.0–7.5) दर्शवतो.",
    google_info: "Google माहिती",
    google_info_sub: "स्थानिक मार्गदर्शन आणि सर्वोत्तम पद्धती",
    open_google: "Google उघडा",
    ph_testing_tips: "pH टेस्टिंग टिप्स",
    fert_vs_ph: "खत vs pH",
    readings: "मोजमाप",
    filter_manage: "आप��्या मोजमापांचे व्यवस्थापन करा.",
    all_locations: "सर्व स्थान",
    search: "शोध…",
    th_date: "तारीख",
    th_location: "स्थान",
    th_ph: "pH",
    th_moisture: "आर्द्रता",
    th_n: "N",
    th_k: "K",
    th_crop: "पिक",
    th_notes: "नोट्स",
    th_actions: "क्रिया",
    empty_table: "अजून कोणतीही नोंद नाही. वरील पहिली नोंद जोडा.",
  },
};

const I18nContext = createContext<{ lang: Lang; setLang: (l: Lang) => void; t: (k: string) => string } | null>(null);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLang] = useState<Lang>("en");
  const t = useMemo(() => {
    const dict = dictionaries[lang];
    return (k: string) => dict[k] ?? k;
  }, [lang]);
  return <I18nContext.Provider value={{ lang, setLang, t }}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
}
